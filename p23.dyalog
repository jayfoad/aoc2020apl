⎕PP←17
p←⍎¨⊃⊃⎕NGET'p23.txt'1
f←{c←r[b←r[a←r[⍵]]] ⋄ k←⊃q[1+(≢p)|p[⍵]-2 3 4 5]~a b c ⋄ ⊃r[⍵ c k]←r[c k ⍵]}
r←1⌽⍳≢q←⍋p ⋄ {}f⍣100⊢1 ⋄ ∊⍕¨1↓p[{⍵,r[⊃⌽⍵]}⍣8⊢q[1]] ⍝ part 1
p,←(≢p)↓⍳1E6
r←1⌽⍳≢q←⍋p ⋄ {}f⍣1E7⊢1 ⋄ ×/p[a,r[a←r[q[1]]]] ⍝ part 2
