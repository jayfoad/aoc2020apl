⎕IO←0 ⋄ ⎕PP←17
p←'\w+'⎕S'&'¨⊃⎕NGET'p14.txt'1
mask←{A∘←'1'=y←⊃⍵ ⋄ B∘←'0'≠y}
mem←{x y←⍎¨⍵ ⋄ a[x]←2⊥B∧A∨(36/2)⊤y}
a←100000/0 ⋄ {{}(⍎⊃⍵)1↓⍵}¨p ⋄ +/a ⍝ part 1
mask←{A∘←'1'=y←⊃⍵ ⋄ B∘←'X'≠y ⋄ C∘←2⊥c⍀(n/2)⊤⍳2*n←+/c←y='X'}
mem←{x y←⍎¨⍵ ⋄ v,←y/⍨≢a,←C+2⊥B∧A∨(36/2)⊤x}
a←v←⍬ ⋄ {{}(⍎⊃⍵)1↓⍵}¨p ⋄ +/a{⊃⌽⍵}⌸v ⍝ part 2
